<script type="text/javascript">


    function menuDropdownClick(e, element) {
        $(element).next('ul').toggle();
        e.stopPropagation();
        e.preventDefault();
    };

    function toggleCompleted(context) {
        let url = '@Url.Content("~/ServiceRequestTask/ToggleTaskCompleted")';

        $.post(url, $(context.form).serialize())
            .done(function (data) {
                taskChanged(data.id, data.serviceRequestId);
                tasklistChanged(data.serviceRequestId);
                serviceRequestStatusChanged(data.serviceRequestId);
            });
    }

    function toggleTaskStatus(serviceRequestTaskId, taskStatusId) {
        let url = '@Url.Content("~/ServiceRequestTask/ToggleTaskStatus")';

        $.post(url,
            {
                serviceRequestTaskId: serviceRequestTaskId,
                taskStatusId: taskStatusId
            })
            .done(function (data) {
                taskChanged(data.id, data.serviceRequestId);
                tasklistChanged(data.serviceRequestId);
                serviceRequestStatusChanged(data.serviceRequestId);
            });
    }

    function changeToDoTasksToWaiting(serviceRequestId) {
        let url = '@Url.Content("~/ServiceRequestTask/UpdateDependentTaskStatuses")';
        $.post(
            url,
            {
                serviceRequestId: serviceRequestId
            },
            function (data) {
                taskChanged(data.id, data.serviceRequestId);
                tasklistChanged(data.serviceRequestId);
                serviceRequestStatusChanged(data.serviceRequestId);
            }
        );
    }

    function onHold(form) {
        let url = '@Url.Content("~/ServiceRequestTask/OnHold")';
        $.post(url,
            form.serialize()
        ).done(function (data) {
            taskChanged(data.id, data.serviceRequestId);
            tasklistChanged(data.serviceRequestId);
            serviceRequestStatusChanged(data.serviceRequestId);
            showCommentForm(data.serviceRequestId, null, 4);  //default to hold type
        });
    }

    function archiveTask(serviceRequestTaskId) {
        let url = '@Url.Content("~/ServiceRequestTask/ArchiveTask")';
        $.post(url,
            {
                serviceRequestTaskId: serviceRequestTaskId
            }
        ).done(function (data) {
            taskChanged(data.id, data.serviceRequestId);
            tasklistChanged(data.serviceRequestId);
        });
    }

    function pickupTask(serviceRequestTaskId) {
        let url = '@Url.Content("~/ServiceRequestTask/PickUp")';
        $.post(
            url,
            {
                serviceRequestTaskId: serviceRequestTaskId
            },
            function (data) {
                taskChanged(data.id, data.serviceRequestId);
                tasklistChanged(data.serviceRequestId);
                serviceRequestStatusChanged(data.serviceRequestId);
            }
        );
    }

    function assignTask(serviceRequestTaskId, assignedTo) {
        let url = '@Url.Content("~/ServiceRequestTask/AssignTo")';
        $.post(
            url,
            {
                serviceRequestTaskId: serviceRequestTaskId,
                assignedTo: assignedTo
            },
            function (data) {
                taskChanged(data.id, data.serviceRequestId);
                tasklistChanged(data.serviceRequestId);
                serviceRequestStatusChanged(data.serviceRequestId);
            }
        );
    }

    function addTask(serviceRequestId, taskId) {
        let url = '@Url.Content("~/ServiceRequestTask/AddTask")';
        $.post(
            url,
            {
                serviceRequestId: serviceRequestId,
                taskId: taskId
            },
            function (data) {
                taskChanged(data.id, data.serviceRequestId);
                tasklistChanged(data.serviceRequestId);
                serviceRequestStatusChanged(data.serviceRequestId);
            }
        );
    };

    function deleteTask(serviceRequestTaskId) {
        let url = '@Url.Content("~/ServiceRequestTask/Delete")';
        $.post(url,
            {
                serviceRequestTaskId: serviceRequestTaskId
            })
            .done(function (data) {
                taskChanged(data.id, data.serviceRequestId);
                tasklistChanged(data.serviceRequestId);
                serviceRequestStatusChanged(data.serviceRequestId);
            });
    }

    function showEditTaskForm(serviceRequestTaskId) {
        let url = '@Url.Content("~/ServiceRequestTask/ShowEditTaskForm/")';
        $.get(url, {
            serviceRequestTaskId: serviceRequestTaskId
        })
        .done(function (result) {
            $('#modal-content').html(result);
            $('#modal-container').modal('toggle');
        });
    }

    function updateTask(form) {
        let url = '@Url.Content("~/ServiceRequestTask/UpdateTask")';
        $.post(url,
            form.serialize()
        ).done(function (data) {
            $('#modal-container').modal('toggle');
            taskChanged(data.id, data.serviceRequestId);
            tasklistChanged(data.serviceRequestId);
            serviceRequestStatusChanged(data.serviceRequestId);
        })
        .error(function (result) {
            $('#modal-content').html(result.responseText);
        });;
    }
    // these are default handlers.

    function taskChanged(serviceRequestTaskId, serviceRequestId) {

    }

    function tasklistChanged(serviceRequestId) {

    }

    function serviceRequestStatusChanged(serviceRequestId) {

    }

</script>
