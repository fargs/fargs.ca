@using WebApp.Library.Extensions
@using Orvosi.Shared.Enums
@model WebApp.ViewModels.DashboardViewModels.IndexViewModel

<script type="text/javascript">

    var WeekFolder = function(data){
        self = this;
        ko.mapping.fromJS(data, {}, self);
    }

    var DayFolder = function (data) {
        self = this;
        ko.mapping.fromJS(data, {}, self);
    }

    var Assessment = function (data) {
        self = this;
        ko.mapping.fromJS(data, {}, self);

        self.showMyTasks = function() {
    
        };

        self.shouldShowMessage = ko.observable(true);
    }

    var mapping = {
        'WeekFolders': {
            create: function(options){
                return new WeekFolder(options.data);
            }
        },
        'DayFolders': {
            create: function(options) {
                return new DayFolder(options.data);
            },
                
        },
        'Assessments': {
            create: function(options) {
                return new Assessment(options.data);
            }
        }
    };

    //var mapping = {
    //    'WeekFolders': {
    //        create: function(options){
    //            return new WeekFolder(options.data);
    //        },
    //        'DayFolders': {
    //            create: function(options) {
    //                return new DayFolder(options.data);
    //            },
    //            'Assessments': {
    //                create: function(options) {
    //                    return new Assessment(options.data);
    //                }
    //            }
    //        }
    //    }
    //};

    var vm = function () {
        self = this;

        var data = @Html.Raw(Model.ToJson());
        
        self.Model = ko.mapping.fromJS(data, mapping);
        
        self.Model.SelectedUserId.subscribe(function (newValue) {
            $.ajax({
                type: "GET",
                url: '@Url.Content("~/dashboard/index?serviceproviderid=")' + newValue,
                contentType: "application/json; charset=utf-8",
                accept: "application/json",
                success: function (result) {
                    ko.mapping.fromJS(result, mapping, self.Model);
                },
                error: function (err) {
                    alert(err.status + " - " + err.statusText);
                }
            });
        });
        return self.Model;
    }

    $(function () {
        $('[data-toggle="popover"]').popover({ html: true });

        ko.applyBindings(new vm());
    });

</script>