@model  WebApp.Models.Appointment.Index
@{
    ViewBag.Title = "Appointments";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<a href="~/Appointment">Appointment List</a>

<h2>Book an Appointment</h2>

<form>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="Claimant">Claimant</label>
                <input type="text" class="form-control" name="Claimant" value="" />
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="Physician">Type</label>
                <select class="form-control" name="AssessmentType">
                    <option></option>
                    <option value="E3F80FDC-3127-49B1-A84D-154688F6730E">Accidental Benefit</option>
                    <option value="45D296D0-4895-41FF-96DE-47DF8B8D8A77">Medical Legal</option>
                </select>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label for="Physician">Physician</label>
        <select id="physician" class="form-control" name="Physician">
            <option></option>
            <option value="e62ebead-c270-4711-81cb-2cbd6b8031ad">Dr. Leslie Farago</option>
            <option value="5303e7b6-bd1c-4668-9b10-a15acc4a80b8">Dr. Anna Waseem</option>
        </select>
    </div>
    <div class="form-group">
        <label for="Date">When</label>
        <div>
            <a id="toggleavailability" class="btn btn-primary" role="button" data-toggle="collapse" href="#availability" aria-expanded="false" aria-controls="availability">
                Select Available Timeslot
            </a>
        </div>
    </div>
    <div class="form-group">
        <div id="availability" class="collapse"></div>
    </div>
</form>
<h3>Documents</h3>
<form id="medbriefs">
    <div class="form-group">
        <div class="btn btn-success fileinput-button">
            <i class="glyphicon glyphicon-plus"></i>
            <span>Add files...</span>
            <input id="fileupload" type="file" name="files[]" multiple="">
        </div>
    </div>
</form>
<table class="table table-bordered table-responsive">
    <thead>
        <tr>
            <th>
                Name
            </th>
            <th>
                Upload Date
            </th>
            <th>
                File Type
            </th>
            <th>
                Contains PHI
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Some important document</td>
            <td>2015-07-10 13:13</td>
            <td>PDF</td>
            <td>YES</td>
        </tr>
        <tr>
            <td>Some other important document</td>
            <td>2015-07-11 11:13</td>
            <td>DOCX</td>
            <td>NO</td>
        </tr>
    </tbody>
</table>


@section Scripts {

    @Scripts.Render("~/bundles/fullcalendar")


    <script type="text/javascript">
        $(document).ready(function () {

            var physicianId = null;

            $('#physician').on('change', function (e) {
                physicianId = $('#physician').find(":selected").val();
            });

            $('#availability').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                defaultView: 'agendaWeek',
                selectable: true,
                minTime: 7,
                maxTime: 21,
                eventSources: [
                    [{
                        title: 'event1',
                        start: '2015-07-19'
                    },
                    {
                        title: 'event2',
                        start: '2015-07-18',
                        end: '2010-01-07'
                    },
                    {
                        title: 'event3',
                        start: '2015-07-20T12:30:00',
                        allDay: false // will make the time show
                    }],
                    function (start, end, callback) {
                        if (physicianId != null) {
                            $.ajax({
                                url: '@Url.Content("~/Calendar/GetAvailability/")' + physicianId,
                                dataType: 'json',
                                //data: {
                                //    // our hypothetical feed requires UNIX timestamps
                                //    start: start,
                                //    end: end
                                //},
                                success: function (doc) {
                                    var events = [];
                                    $(doc).find('event').each(function () {
                                        events.push({
                                            title: $(this).attr('title'),
                                            start: $(this).attr('start') // will be parsed
                                        });
                                    });
                                    callback(events);
                                }
                            });
                        }
                    }
                ]
            });

            $('#availability').on('shown.bs.collapse', function () {
                $('#availability').fullCalendar('render');
            })

            //$('#fileupload').fileupload({
            //    dataType: 'json',
            //    done: function (e, data) {
            //        $.each(data.result.files, function (index, file) {
            //            $('<p/>').text(file.name).appendTo(document.body);
            //        });
            //    }
            //});
        });

    </script>
}
