<script type="text/javascript">

    function navigateToWorkflow(workflowId) {
        refreshWorkflowList(workflowId);
        refreshWorkflowReadOnly(workflowId);
    }

    function showNewWorkflowForm() {
        var url = '@Url.Content("~/Workflows/Workflow/ShowNewWorkflowForm")';

        $.get(url)
        .done(function (result) {
            $('#modal-content-sm').html(result);
            $('#modal-container-sm').modal('toggle');
        });
    }

    function showEditWorkflowForm(workflowId) {
        var url = '@Url.Content("~/Workflows/Workflow/ShowEditWorkflowForm")';

        $.get(url, {
            workflowId: workflowId
        })
        .done(function (result) {
            $('#modal-content-sm').html(result);
            $('#modal-container-sm').modal('toggle');
        });
    }

    function showDeleteWorkflowConfirmation(workflowId) {
        var url = '@Url.Content("~/Workflows/Workflow/ShowDeleteWorkflowConfirmation")';

        $.get(url, {
            workflowId: workflowId
        })
        .done(function (result) {
            $('#modal-content-sm').html(result);
            $('#modal-container-sm').modal('toggle');
        });
    }

    function showNewWorkItemForm(workflowId) {
        $.get('@Url.Content("~/Workflows/WorkItem/Create")', {
            workflowId: workflowId
        })
        .done(function (result) {
            $('#modal-content').html(result);
            $('#modal-container').modal('toggle');
        });
    }
    
    function saveNewWorkflowForm(form) {
        var url = '@Url.Content("~/Workflows/Workflow/SaveNewWorkflowForm")';

        $.post(url,
            form.serialize()
        )
        .done(function (result) {
            $('#modal-container-sm').modal('toggle');
            toastr.success("Workflow added successfully");
            refreshWorkflowList(result.id);
            refreshWorkflowReadOnly(result.id);
        }).error(function (result) {
            $('#modal-content-sm').html(result.responseText);
        });
    }

    function saveEditWorkflowForm(form) {
        var url = '@Url.Content("~/Workflows/Workflow/SaveEditWorkflowForm")';

        $.post(url,
            form.serialize()
        )
        .done(function (result) {
            $('#modal-container-sm').modal('toggle');
            toastr.success("Workflow added successfully");
            refreshWorkflowReadOnly(result.id);
        }).error(function (result) {
            $('#modal-content-sm').html(result.responseText);
        });
    }

    function removeWorkflow(workflowId) {
        var url = '@Url.Content("~/Workflows/Workflow/Remove")';

        $.post(url, {
            workflowId: workflowId
        })
        .done(function () {
            toastr.success("Workflow removed successfully");
            refreshWorkflowList();
            refreshWorkflowReadOnly();
        });
    }

    function saveNewWorkItemForm(workflowId, form) {

        $.post('@Url.Content("~/Workflows/WorkItem/Create")',
            form.serialize()
        )
        .done(function (result) {
            $('#modal-container').modal('toggle');
            toastr.success("Work Item added successfully");
            refreshWorkflowList(workflowId);
            refreshWorkflowReadOnly(workflowId);
        }).error(function (result) {
            $('#modal-content').html(result.responseText);
        });
    }
    
    function refreshWorkflowList(workflowId) {
        let url = '@Url.Content("~/Workflows/Workflow/List")';
        $.get(url, {
            workflowId: workflowId
        })
            .done(function (result) {
                $('#workflow-list-container').html(result);
            });
    }
    function refreshWorkflowReadOnly(workflowId) {

        let url = new URL(window.location);
        url.searchParams.set('workflowId', workflowId);
        history.pushState({}, "", url);

        $.get('@Url.Content("~/Workflows/Workflow/ReadOnly")', {
            workflowId: workflowId
        })
        .done(function (result) {
            $('#workflow-readonly-container').html(result);
        });
    }

</script>
