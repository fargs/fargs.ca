@using WebApp.Library.Extensions
@using Features = Orvosi.Shared.Enums.Features
@using WebApp.ViewDataModels
@using WebApp.ViewModels.ServiceRequestViewModels
@using WebApp.FormModels
@using LinqKit
@model CaseViewModel

@{
    var identity = User.Identity.GetClaimsIdentity();
    var roleId = identity.GetRoleId();
    var features = identity.GetFeatures();
    var filter = ViewData.ViewFilter_Get();
    var target = ViewData.ViewTarget_Get();
    var viewData = new ViewDataDictionary();
    viewData.ViewFilter_Set(filter);
    viewData.ViewTarget_Set(target);

    TaskViewModel task = null;
    int selectedTask;
    var qs = this.Request.QueryString.Get("selectedTask");
    if (int.TryParse(qs, out selectedTask))
    {
        task = Model.Tasks.SingleOrDefault(c => c.Id == selectedTask);
    }

    ViewBag.Title = Model.ClaimantName;
}

@Html.Partial("~/Views/ServiceRequest/_Details.cshtml")

@Html.Partial("ModalContainer")
@Html.Partial("ModalContainerSmall")

@Html.Partial("~/Views/Note/_NoteModalForm.cshtml")

@section Scripts {


    <script src="@Url.Content("~/signalr/hubs")"></script>
    @Html.Partial("~/Views/ServiceRequestMessage/_ServiceRequestMessageJS.cshtml", new ServiceRequestMessageJSViewModel { ServiceRequestIds = new int[1] { Model.ServiceRequestId } })
    @Html.Partial("~/Views/ServiceRequestTask/TaskListJS.cshtml")
    @Html.Partial("~/Views/Cancellation/CancellationJS.cshtml")
    @Html.Partial("~/Views/Reschedule/_RescheduleJS.cshtml")
    @Html.Partial("~/Views/ServiceRequest/CaseJS.cshtml")
    @Html.Partial("~/Views/Box/BoxJS.cshtml")
    @Html.Partial("~/Views/Resources/_ResourceJS.cshtml")
    @Html.Partial("~/Views/ServiceRequest/InvoiceJS.cshtml")
    @Html.Partial("~/Views/Comment/_CommentJS.cshtml")
    @Html.Partial("~/Views/ServiceRequest/Company/_CompanyJS.cshtml")
    @Html.Partial("~/Views/ServiceRequest/Service/_ServiceJS.cshtml")
    @Html.Partial("~/Views/ServiceRequest/Claimant/_ClaimantJS.cshtml")
    @Html.Partial("~/Views/ServiceRequest/Address/_AddressJS.cshtml")
    @Html.Partial("~/Views/Teleconference/_TeleconferenceJS.cshtml")
    @Html.Partial("~/Views/ServiceRequest/_DetailsJS.cshtml")

    <script>
        $(document).ready(function () {
            boxInfoChanged(@Model.ServiceRequestId);
            refreshGoogleCalendarIntegration(@Model.ServiceRequestId);
        });
    </script>
}
