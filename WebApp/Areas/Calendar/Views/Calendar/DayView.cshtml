@using FluentDateTime
@using System.Globalization
@using WebApp.Library
@model WebApp.Areas.Calendar.Views.Calendar.DayView
@{
    var seconds = new int[4] { 00, 15, 30, 45 };
    var slots = Enumerable.Range(0, 24).SelectMany(i => seconds, (h, i) => new TimeSpan(h, i, 0)).OrderBy(c => c);

    var viewDataService = DependencyResolver.Current.GetService<ViewDataService>();

    var roleId = User.Identity.GetRoleId();
    var userId = User.Identity.GetGuidUserId();
    var physicianId = User.Identity.GetUserContext().Id;
    var features = User.Identity.GetFeatures();

    var companySelectList = viewDataService.GetPhysicianCompanySelectList(physicianId);
    var addressSelectList = viewDataService.GetPhysicianAddressSelectList(physicianId);
}

<section>
    @if (Model.AvailableDay == null)
    {

        <form action="~/Availability/AddDay" method="post" class="form-horizontal">

            @Html.Hidden("PhysicianId", physicianId)

            <div class="form-group">
                <label class="control-label col-md-2">Location</label>
                <div class="col-md-10">
                    @Html.DropDownList("LocationId", new SelectList(addressSelectList, "Value", "Text", "Group.Name", new { }), string.Empty, new { @class = "form-control" })
                    @Html.ValidationMessage("LocationId", "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2">Company</label>
                <div class="col-md-10">
                    @Html.DropDownList("CompanyId", new SelectList(companySelectList, "Value", "Text", "Group.Name", new { }), string.Empty, new { @class = "form-control" })
                    @Html.ValidationMessage("CompanyId", "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-push-2 col-md-10">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </div>

        </form>
    }
    else
    {
        <form action="~/Availability/AddSlots" method="post">
            @Html.Hidden("AvailableDayId", Model.AvailableDay.Id)
            <div class="bootstrap-timepicker">
                <select name="StartHour">
                    <option value="7">7h</option>
                    <option value="8" selected>8h</option>
                    <option value="9">9h</option>
                    <option value="10">10h</option>
                    <option value="11">11h</option>
                    <option value="12">12h</option>
                    <option value="13">13h</option>
                    <option value="14">14h</option>
                    <option value="15">15h</option>
                    <option value="16">16h</option>
                    <option value="17">17h</option>
                    <option value="18">18h</option>
                    <option value="19">19h</option>
                    <option value="20">20h</option>
                    <option value="21">21h</option>
                </select>
                <select name="StartMinute">
                    <option value="00">00</option>
                    <option value="15">15</option>
                    <option value="30">30</option>
                    <option value="45">45</option>
                </select>
                <select name="Duration">
                    <option value="15">15</option>
                    <option value="30">30</option>
                    <option value="45">45</option>
                    <option value="60" selected>1h</option>
                    <option value="75">1h15</option>
                    <option value="90">1h30</option>
                    <option value="105">1h45</option>
                    <option value="120">2h</option>
                </select>
                <select name="Repeat">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
                <button type="submit" class="btn btn-default btn-sm">Add Slot(s)</button>
            </div>
        </form>
        <div style="padding-top:10px;">
            <strong>@Model.AvailableDay.Day.ToOrvosiDateFormat()</strong>
        </div>
        <div style="display:flex; flex-wrap:nowrap; flex-direction:row; align-content:center; align-self:stretch;">
            <div style="padding-top:5px; padding-bottom:5px">
                @if (Model.AvailableDay.Address != null)
                {
                    <div>@Model.AvailableDay.Address.City</div>
                }
            </div>
        </div>
        foreach (var slot in Model.AvailableDay.AvailableSlots)
        {
            <div>
                @slot.StartTime.ToShortTimeSafe()
            </div>
        }
    }
    @foreach (var slot in slots)
    {
        <div class="@(slot.Minutes == 0 ? "h5" : "")">@slot.ToString()</div>
    }
</section>
